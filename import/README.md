# Импорт данных из Excel

Документы импорта описывают процесс загрузки водителей из Excel-файлов в GTrack.

## Ожидаемый формат файла

- Формат: `xlsx`.
- Первый лист содержит таблицу без объединённых ячеек.
- Обязательные колонки (строго в латинице):
  - `full_name` — ФИО водителя.
  - `phone` — номер телефона в формате `+7XXXXXXXXXX`.
  - `vehicle_plate` — государственный номер автомобиля.
  - `license_expiry` — дата окончания водительского удостоверения (ISO8601 или `ДД.ММ.ГГГГ`).
  - `medical_certificate_expiry` — дата окончания медицинской справки.
  - `insurance_expiry` — дата окончания страховки ТС.
- Необязательные колонки:
  - `dispatcher_email` — e-mail закреплённого диспетчера.
  - `notes` — произвольные комментарии.

## Валидация

1. Структурная проверка колонок: наличие всех обязательных заголовков, отсутствие дубликатов.
2. Типизация данных: даты преобразуются в ISO8601, телефон валидируется по E.164.
3. Бизнес-правила:
   - сроки действия документов не должны быть в прошлом более чем на 365 дней;
   - телефон должен быть уникальным среди уже существующих водителей;
   - при наличии `dispatcher_email` он сверяется с каталогом пользователей.
4. Ошибки и предупреждения формируются в отчёт, который возвращается автору импорта.

## Процесс загрузки

1. Файл загружается через админ-панель или API `/import/drivers`.
2. Backend сохраняет оригинал в `import/source/<yyyy-mm-dd>/<timestamp>.xlsx` для аудита.
3. После успешной валидации создаётся задача на пакетное добавление водителей.
4. Итоговый статус (успех/ошибки) отправляется на почту инициатора и отображается в журнале импортов.

> Папка `import/source/` хранится вне репозитория и подключается как защищённое хранилище. Добавление исходников будет выполнено отдельно.
