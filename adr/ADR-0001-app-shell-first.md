# ADR-0001: App Shell First

- Status: Accepted
- Date: 2025-09-21
- Deciders: Core Platform Team

## Контекст

Запуск GTrack как SaaS подразумевает быстрое предоставление устойчивого каркаса приложения: авторизация, роутинг и глобальная навигация должны появиться первыми, чтобы команды могли независимо подключать бизнес-модули. Одновременно требуется поддерживать офлайн-доступ к критичным разделам и контролировать производительность первого рендера.

## Решение

Применяем стратегию **App Shell First**:

- Сначала создаем минимальный shell Next.js-приложения: экран логина, layout с верхним меню и боковой навигацией, настройку маршрутизации и стейт-менеджмент авторизованного пользователя.
- После стабилизации shell подключаем функциональные модули (диспетчеризация, отчеты и т.д.) через code splitting и lazy loading, чтобы не блокировать первый рендер.
- Кэшируем shell через сервис-воркер и HTTP-кеширование статики, чтобы обеспечить мгновенное открытие и работу в нестабильной сети.
- Интерфейсы данных заворачиваем в контрактные хранилища (React Query/RTK Query) для унифицированной работы онлайн/офлайн и повторного использования между модулями.

## Последствия

- Shell можно разворачивать отдельно от бизнес-модулей, ускоряя первые релизы и бета-тестирование.
- Требуется строгая дисциплина: shell не должен содержать бизнес-логику, а только каркас, авторизацию и навигацию.
- Сервис-воркер увеличивает сложность отладки, необходимы гайды для разработчиков и fallback-стратегии на случай некорректного кеша.
